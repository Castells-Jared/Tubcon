<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TUBCON</title>

    <!-- CSS Principal -->
    <link rel="stylesheet" href="src/index.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="public/images/iconoa.ico">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- CSS del Chatbot (externo) -->
    <link rel="stylesheet" href="src/chatbot.css">
    
    <style>
        /* ESTILOS PARA OCULTAR HEADER SOLO EN MÓVIL CUANDO CHATBOT ESTÉ ABIERTO */
        @media (max-width: 768px) {
            header {
                transition: opacity 0.3s ease, visibility 0.3s ease;
            }
            
            body.chatbot-active header {
                opacity: 0;
                visibility: hidden;
            }
        }
        
        /* Asegurar que el chatbot móvil tenga el z-index correcto */
        .chatbot-mobile-window.active {
            z-index: 1003;
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">
            <img src="public/images/logo.png" class="logo" alt="TUBCON S.A. de C.V." />
        </div>

        <!-- Menú normal (solo desktop) -->
        <nav class="menu-desktop">
            <ul>
                <li><a href="index.html" style="color:#EF0315">Inicio</a></li>
                <li><a href="#quienes-somos">¿Quiénes somos?</a></li>
                <li><a href="products.html">Productos</a></li>
                <li><a href="ubication.html">Instalaciones</a></li>
                <li><a href="email.html">Asesoría</a></li>
                <li><a href="contact.html">Contacto</a></li>
            </ul>
        </nav>

        <!-- Botón hamburguesa (solo móvil) -->
        <button class="hamburger" id="hamburger">&#9776;</button>

        <!-- Menú lateral overlay (solo móvil) -->
        <nav id="sidebar">
            <button class="close" id="close">&times;</button>

            <!-- Logo en el sidebar -->
            <div class="sidebar-logo">
                <img src="public/images/logo.png" alt="TUBCON S.A. de C.V.">
            </div>
            <br>
            <br>

            <ul>
                <li><a href="index.html" style="color:#EF0315">Inicio</a></li>
                <li><a href="#quienes-somos">¿Quiénes somos?</a></li>
                <li><a href="products.html">Productos</a></li>
                <li><a href="ubication.html">Instalaciones</a></li>
                <li><a href="email.html">Asesoría</a></li>
                <li><a href="contact.html">Contacto</a></li>
            </ul>

            <div class="sidebar-bottom">
                <a href="https://www.google.com/maps?q=TUBCON%20SA%20DE%20CV" target="_blank">
                    <i class="fa-solid fa-location-dot"></i> Dónde comprar
                </a>
                <a href="#">Sé un distribuidor TUBCON</a>
                <a href="https://wa.me/5543225189" target="_blank">
                    <i class="fa-solid fa-phone"></i> 55-43-22-51-89
                </a>
            </div>
        </nav>
    </header>

    <!-- Sección Hero con el carrusel -->
    <section id="inicio" class="hero">
        <div class="carousel">
            <div class="slides">
                <img src="public/images/fondo.png" alt="Imagen 1">
                <img src="public/images/fondo2.jpg" alt="Imagen 2">
                <img src="public/images/fondo3.jpg" alt="Imagen 3">
            </div>
        </div>
        <div class="hero-text">
            <h1>Expertos en plomería</h1>
            <p>Tubos, conexiones y accesorios de PVC</p>
        </div>
    </section>

    <!-- Sección ¿Quiénes somos? -->
    <section id="quienes-somos">
        <h2>¿Quiénes somos?</h2>
        <p>Tubcon es una empresa enfocada principalmente a la distribución de mayoreo de material de plomería en general
            trabajando principalmente con las mejores marcas del mercado, comprando la mayoría de sus productos directo
            de fábrica, satisfaciendo así al público en general, mayoristas y constructores con los mejores precios del
            mercado.</p>
    </section>

    <!-- Sección Misión y Visión CORREGIDA -->
    <section id="mision-vision">
        <div class="grid">
            <div class="item">
                <h2>Misión</h2>
                <h3>Comercializar productos con marcadas especificaciones técnicas para uso industrial que combinados
                    con el desarrollo de ingeniería, tecnología y servicio postventa satisfacen necesidades de nuestros
                    clientes, asegurando el crecimiento de la empresa, los utilidades de los accionistas y la calidad de
                    vida de los miembros de la organización.</h3>
            </div>
            <div class="item">
                <h2>Visión</h2>
                <h3>Consolidar nuestra EMPRESA en la industria y el comercio, contando con un talento humano competente
                    que promueve el desarrollo y crecimiento de la organización organizando la excelente relación con
                    nuestros clientes y proveedores.</h3>
            </div>
        </div>
    </section>

    <footer>
        <p>© 2025 TUBCON S.A. de C.V. Todos los derechos reservados.</p>
        <p>Síguenos en redes sociales</p>
    </footer>

    <div id="overlay"></div>

    <!-- Chatbot ORIGINAL para desktop -->
    <div class="chatbot-container" id="desktopChatbot">
        <div class="chatbot-header" id="chatbotToggle">
            <span>Asistente TUBCON</span>
            <i class="fas fa-robot"></i>
        </div>
        <div class="chatbot-body" id="chatbotBody">
            <div class="chatbot-messages" id="chatbotMessages"></div>
            <div class="chatbot-input">
                <input type="text" id="userInput" placeholder="Escribe tu pregunta...">
                <button id="sendButton"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- Chatbot BURBUJA para móvil -->
    <div class="chatbot-bubble" id="mobileChatbotBubble">
        <i class="fas fa-comment"></i>
    </div>

    <div class="chatbot-mobile-window" id="mobileChatbotWindow">
        <div class="chatbot-header">
            <span>Asistente TUBCON</span>
            <button class="close-chat" id="closeMobileChat">×</button>
        </div>
        <div class="chatbot-messages" id="mobileChatbotMessages"></div>
        <div class="chatbot-input">
            <input type="text" id="mobileUserInput" placeholder="Escribe tu pregunta...">
            <button id="mobileSendButton"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- JavaScript del menú móvil -->
    <script>
         // Control del menú hamburguesa
    document.addEventListener('DOMContentLoaded', function () {
        const hamburger = document.getElementById('hamburger');
        const sidebar = document.getElementById('sidebar');
        const closeBtn = document.getElementById('close');
        const overlay = document.getElementById('overlay');

        // Abrir menú
        hamburger.addEventListener('click', function () {
            sidebar.classList.add('active');
            overlay.classList.add('active');
            document.body.classList.add('menu-active'); // Añadir clase al body
            document.body.style.overflow = 'hidden'; // Evitar scroll
        });

        // Cerrar menú
        closeBtn.addEventListener('click', closeMenu);
        overlay.addEventListener('click', closeMenu);

        // Cerrar con Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') closeMenu();
        });

        function closeMenu() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            document.body.classList.remove('menu-active'); // Quitar clase del body
            document.body.style.overflow = ''; // Restaurar scroll
        }
    });
    </script>

    <!-- Importar la lógica JavaScript como módulo -->
    <script type="module">
        // Importar las funciones desde el archivo JavaScript
        import {
            knowledgeBase,
            procesarMensaje,
            consultarWitAI,
            procesarEntidadesWit,
            procesarRespuestaLocal,
            consultarGemini
        } from './chatbot.js';

        // JavaScript del Chatbot
        // Inicializar chatbot cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function () {
            // Selecciona un saludo al azar
            const saludoAleatorio = knowledgeBase.saludos[
                Math.floor(Math.random() * knowledgeBase.saludos.length)
            ];

            // Inserta el saludo en ambos contenedores de mensajes
            const mensajeDivDesktop = document.createElement('div');
            mensajeDivDesktop.className = 'message bot-message';
            mensajeDivDesktop.textContent = saludoAleatorio;
            document.getElementById('chatbotMessages').appendChild(mensajeDivDesktop);

            const mensajeDivMobile = document.createElement('div');
            mensajeDivMobile.className = 'message bot-message';
            mensajeDivMobile.textContent = saludoAleatorio;
            document.getElementById('mobileChatbotMessages').appendChild(mensajeDivMobile);

            // Configurar event listeners para desktop
            document.getElementById('chatbotToggle').addEventListener('click', toggleChat);
            document.getElementById('sendButton').addEventListener('click', function() {
                sendMessage('userInput', 'chatbotMessages');
            });
            document.getElementById('userInput').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    sendMessage('userInput', 'chatbotMessages');
                }
            });

            // Configurar event listeners para móvil
            document.getElementById('mobileSendButton').addEventListener('click', function() {
                sendMessage('mobileUserInput', 'mobileChatbotMessages');
            });
            document.getElementById('mobileUserInput').addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    sendMessage('mobileUserInput', 'mobileChatbotMessages');
                }
            });
        });

        // Estado del chatbot
        let isChatOpen = false;

        // Función para alternar el chatbot
        function toggleChat() {
            const chatBody = document.getElementById('chatbotBody');
            isChatOpen = !isChatOpen;

            if (isChatOpen) {
                chatBody.classList.add('active');
                // Solo añadir la clase chatbot-active en dispositivos móviles
                if (window.innerWidth <= 768) {
                    document.body.classList.add('chatbot-active');
                }
                // Hacer scroll al final después de la animación
                setTimeout(() => {
                    const messages = document.getElementById('chatbotMessages');
                    messages.scrollTop = messages.scrollHeight;
                }, 300);
            } else {
                chatBody.classList.remove('active');
                // Solo quitar la clase chatbot-active en dispositivos móviles
                if (window.innerWidth <= 768) {
                    document.body.classList.remove('chatbot-active');
                }
            }
        }

        // Función para enviar mensaje
        async function sendMessage(inputId, messagesId) {
            const userInput = document.getElementById(inputId);
            const messageText = userInput.value.trim();

            if (!messageText) return;

            // Agregar mensaje del usuario
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'message user-message';
            userMessageDiv.textContent = messageText;
            document.getElementById(messagesId).appendChild(userMessageDiv);

            // Limpiar input y mantener el foco
            userInput.value = '';
            userInput.focus();

            // Hacer scroll al final
            const messages = document.getElementById(messagesId);
            messages.scrollTop = messages.scrollHeight;

            // Mostrar indicador de typing
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message typing-indicator';
            typingDiv.innerHTML = '<span></span><span></span><span></span>';
            messages.appendChild(typingDiv);
            messages.scrollTop = messages.scrollHeight;

            // Usar la función importada
            try {
                const respuesta = await procesarMensaje(messageText);

                // Eliminar indicador de typing
                const typingIndicator = messages.querySelector('.typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }

                // Mostrar la respuesta
                appendBotMessage(respuesta, messagesId);

            } catch (error) {
                console.error("Error procesando mensaje:", error);

                // Eliminar indicador de typing
                const typingIndicator = messages.querySelector('.typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }

                // Mostrar mensaje de error
                appendBotMessage("No pude procesar tu solicitud en este momento. ¿Podrías intentarlo de nuevo?", messagesId);
            }
        }

        // Función auxiliar para agregar mensajes del bot
        function appendBotMessage(message, messagesId) {
            const botMessageDiv = document.createElement('div');
            botMessageDiv.className = 'message bot-message';
            botMessageDiv.innerHTML = message;
            document.getElementById(messagesId).appendChild(botMessageDiv);

            // Hacer scroll al final
            const messages = document.getElementById(messagesId);
            messages.scrollTop = messages.scrollHeight;
        }

        // Control chatbot móvil - CORREGIDO Y COMPLETO
        const mobileBubble = document.getElementById('mobileChatbotBubble');
        const mobileWindow = document.getElementById('mobileChatbotWindow');
        const closeMobile = document.getElementById('closeMobileChat');

        // Event listeners para abrir y cerrar el chatbot móvil
        if (mobileBubble && mobileWindow && closeMobile) {
            mobileBubble.addEventListener('click', function() {
                mobileWindow.classList.add('active');
                document.body.classList.add('chatbot-active'); // Ocultar header
                document.body.style.overflow = 'hidden'; // Evitar scroll del body
            });

            closeMobile.addEventListener('click', function() {
                mobileWindow.classList.remove('active');
                document.body.classList.remove('chatbot-active'); // Mostrar header
                document.body.style.overflow = ''; // Restaurar scroll
            });

            // Agrega esto para el deslizamiento en móvil
            let startY = 0;
            mobileWindow.addEventListener('touchstart', function(e) {
                startY = e.touches[0].clientY;
            });

            mobileWindow.addEventListener('touchmove', function(e) {
                const currentY = e.touches[0].clientY;
                if (currentY - startY > 100) {
                    mobileWindow.classList.remove('active');
                    document.body.classList.remove('chatbot-active'); // Mostrar header
                    document.body.style.overflow = ''; // Restaurar scroll
                }
            });
        }
    </script>
    <!-- Burbuja de WhatsApp -->
<div class="whatsapp-float" id="whatsappFloat">
    <a href="https://wa.me/525543225189" id="whatsappLink" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>
    <div class="whatsapp-tooltip">
        ¿Necesitas ayuda? Chatea con nosotros por WhatsApp
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Detectar si es dispositivo móvil
        function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
        }
        
        // Configurar el comportamiento del botón de WhatsApp
        const whatsappLink = document.getElementById('whatsappLink');
        
        if (isMobileDevice()) {
            // En móviles, abrir directamente la app de WhatsApp
            whatsappLink.href = "https://wa.me/525543225189";
        } else {
            // En desktop, abrir WhatsApp Web
            whatsappLink.href = "https://web.whatsapp.com/send?phone=525543225189";
        }
    });
</script>
</body>

</html>